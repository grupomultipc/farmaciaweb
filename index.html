<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmacia El Ahorro - Sistema de Gestión</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .sidebar {
            min-height: 100vh;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
        }
        .card-counter {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        .card-counter:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        .navbar-brand {
            font-weight: bold;
        }
        .active-nav {
            background-color: #0d6efd;
            color: white !important;
        }
        .table-responsive {
            min-height: 400px;
        }
        .search-box {
            max-width: 300px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-prescription2"></i> Farmacia El Ahorro
            </a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar py-3">
                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active-nav" onclick="showSection('dashboard')">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" onclick="showSection('productos')">
                        <i class="bi bi-capsule"></i> Productos
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" onclick="showSection('clientes')">
                        <i class="bi bi-people"></i> Clientes
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" onclick="showSection('proveedores')">
                        <i class="bi bi-truck"></i> Proveedores
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" onclick="showSection('empleados')">
                        <i class="bi bi-person-badge"></i> Empleados
                    </a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 py-3">
                <!-- Dashboard Section -->
                <div id="dashboard-section">
                    <h2 class="mb-4">Dashboard</h2>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card card-counter bg-primary text-white text-center p-3">
                                <h3><i class="bi bi-capsule"></i></h3>
                                <h4 id="productos-count">0</h4>
                                <p>Productos</p>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card card-counter bg-success text-white text-center p-3">
                                <h3><i class="bi bi-people"></i></h3>
                                <h4 id="clientes-count">0</h4>
                                <p>Clientes</p>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card card-counter bg-warning text-white text-center p-3">
                                <h3><i class="bi bi-truck"></i></h3>
                                <h4 id="proveedores-count">0</h4>
                                <p>Proveedores</p>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card card-counter bg-info text-white text-center p-3">
                                <h3><i class="bi bi-person-badge"></i></h3>
                                <h4 id="empleados-count">0</h4>
                                <p>Empleados</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Productos Section -->
                <div id="productos-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Gestión de Productos</h2>
                        <button class="btn btn-primary" onclick="showProductoForm()">
                            <i class="bi bi-plus-circle"></i> Nuevo Producto
                        </button>
                    </div>
                    
                    <div class="mb-3">
                        <div class="input-group search-box">
                            <input type="text" id="search-producto" class="form-control" placeholder="Buscar producto...">
                            <button class="btn btn-outline-secondary" onclick="buscarProductos()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Stock</th>
                                    <th>Precio Unitario</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="productos-table">
                                <!-- Los productos se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Clientes Section -->
                <div id="clientes-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Gestión de Clientes</h2>
                        <button class="btn btn-primary" onclick="showClienteForm()">
                            <i class="bi bi-plus-circle"></i> Nuevo Cliente
                        </button>
                    </div>
                    
                    <div class="mb-3">
                        <div class="input-group search-box">
                            <input type="text" id="search-cliente" class="form-control" placeholder="Buscar cliente...">
                            <button class="btn btn-outline-secondary" onclick="buscarClientes()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Teléfono</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="clientes-table">
                                <!-- Los clientes se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Proveedores Section -->
                <div id="proveedores-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Gestión de Proveedores</h2>
                        <button class="btn btn-primary" onclick="showProveedorForm()">
                            <i class="bi bi-plus-circle"></i> Nuevo Proveedor
                        </button>
                    </div>
                    
                    <div class="mb-3">
                        <div class="input-group search-box">
                            <input type="text" id="search-proveedor" class="form-control" placeholder="Buscar proveedor...">
                            <button class="btn btn-outline-secondary" onclick="buscarProveedores()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Contacto</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="proveedores-table">
                                <!-- Los proveedores se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Empleados Section -->
                <div id="empleados-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Gestión de Empleados</h2>
                        <button class="btn btn-primary" onclick="showEmpleadoForm()">
                            <i class="bi bi-plus-circle"></i> Nuevo Empleado
                        </button>
                    </div>
                    
                    <div class="mb-3">
                        <div class="input-group search-box">
                            <input type="text" id="search-empleado" class="form-control" placeholder="Buscar empleado...">
                            <button class="btn btn-outline-secondary" onclick="buscarEmpleados()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Cargo</th>
                                    <th>Salario</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="empleados-table">
                                <!-- Los empleados se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para formularios -->
    <div class="modal fade" id="formModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Formulario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- El formulario se cargará aquí -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast para mensajes -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notificación</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Mensaje aquí
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables globales
        let db;
        let currentSection = 'dashboard';
        let editingId = null;
        const modal = new bootstrap.Modal(document.getElementById('formModal'));
        const toast = new bootstrap.Toast(document.getElementById('liveToast'));

        // Inicializar la base de datos al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            initDB();
            updateCounts();
            showSection('dashboard');
        });

        // Inicializar IndexedDB
        function initDB() {
            const request = indexedDB.open('FarmaciaDB', 1);
            
            request.onerror = function(event) {
                showToast('Error', 'No se pudo abrir la base de datos', 'danger');
            };
            
            request.onupgradeneeded = function(event) {
                db = event.target.result;
                
                // Crear object stores (tablas)
                if (!db.objectStoreNames.contains('producto')) {
                    const productoStore = db.createObjectStore('producto', { keyPath: 'id', autoIncrement: true });
                    productoStore.createIndex('nombre', 'nombre', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('cliente')) {
                    const clienteStore = db.createObjectStore('cliente', { keyPath: 'id', autoIncrement: true });
                    clienteStore.createIndex('nombre', 'nombre', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('proveedor')) {
                    const proveedorStore = db.createObjectStore('proveedor', { keyPath: 'id', autoIncrement: true });
                    proveedorStore.createIndex('nombre', 'nombre', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('empleado')) {
                    const empleadoStore = db.createObjectStore('empleado', { keyPath: 'id', autoIncrement: true });
                    empleadoStore.createIndex('nombre', 'nombre', { unique: false });
                }
            };
            
            request.onsuccess = function(event) {
                db = event.target.result;
                showToast('Éxito', 'Base de datos inicializada correctamente', 'success');
                cargarDatosIniciales();
            };
        }

        // Cargar datos iniciales si es necesario
        function cargarDatosIniciales() {
            // Verificar si ya hay datos
            const transaction = db.transaction(['producto'], 'readonly');
            const store = transaction.objectStore('producto');
            const countRequest = store.count();
            
            countRequest.onsuccess = function() {
                if (countRequest.result === 0) {
                    // Datos de ejemplo
                    const datosEjemplo = {
                        producto: [
                            { nombre: 'Paracetamol 500mg', stock: 100, precio_unitario: 5.50 },
                            { nombre: 'Ibuprofeno 400mg', stock: 80, precio_unitario: 6.20 },
                            { nombre: 'Amoxicilina 500mg', stock: 50, precio_unitario: 12.80 }
                        ],
                        cliente: [
                            { nombre: 'Juan Pérez', telefono: '555-1234' },
                            { nombre: 'María García', telefono: '555-5678' }
                        ],
                        proveedor: [
                            { nombre: 'Farmacéutica Central', contacto: 'contacto@farmaceuticacentral.com' },
                            { nombre: 'Medicamentos S.A.', contacto: 'ventas@medicamentossa.com' }
                        ],
                        empleado: [
                            { nombre: 'Carlos López', cargo: 'Farmacéutico', salario: 2500 },
                            { nombre: 'Ana Martínez', cargo: 'Cajera', salario: 1500 }
                        ]
                    };
                    
                    // Insertar datos de ejemplo
                    for (const [tabla, datos] of Object.entries(datosEjemplo)) {
                        const transaction = db.transaction([tabla], 'readwrite');
                        const store = transaction.objectStore(tabla);
                        
                        datos.forEach(item => {
                            store.add(item);
                        });
                    }
                    
                    showToast('Info', 'Datos de ejemplo cargados', 'info');
                }
                updateCounts();
                cargarProductos();
                cargarClientes();
                cargarProveedores();
                cargarEmpleados();
            };
        }

        // Mostrar u ocultar secciones
        function showSection(section) {
            // Ocultar todas las secciones
            document.querySelectorAll('[id$="-section"]').forEach(sec => {
                sec.style.display = 'none';
            });
            
            // Mostrar la sección seleccionada
            document.getElementById(section + '-section').style.display = 'block';
            currentSection = section;
            
            // Actualizar datos según la sección
            switch(section) {
                case 'productos':
                    cargarProductos();
                    break;
                case 'clientes':
                    cargarClientes();
                    break;
                case 'proveedores':
                    cargarProveedores();
                    break;
                case 'empleados':
                    cargarEmpleados();
                    break;
                case 'dashboard':
                    updateCounts();
                    break;
            }
        }

        // Actualizar contadores del dashboard
        function updateCounts() {
            contarRegistros('producto', 'productos-count');
            contarRegistros('cliente', 'clientes-count');
            contarRegistros('proveedor', 'proveedores-count');
            contarRegistros('empleado', 'empleados-count');
        }

        function contarRegistros(tabla, elementId) {
            const transaction = db.transaction([tabla], 'readonly');
            const store = transaction.objectStore(tabla);
            const countRequest = store.count();
            
            countRequest.onsuccess = function() {
                document.getElementById(elementId).textContent = countRequest.result;
            };
        }

        // Mostrar toast de notificación
        function showToast(title, message, type = 'info') {
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').textContent = message;
            
            const toastElement = document.getElementById('liveToast');
            toastElement.className = 'toast';
            
            switch(type) {
                case 'success':
                    toastElement.classList.add('bg-success', 'text-white');
                    break;
                case 'danger':
                    toastElement.classList.add('bg-danger', 'text-white');
                    break;
                case 'warning':
                    toastElement.classList.add('bg-warning', 'text-dark');
                    break;
                default:
                    toastElement.classList.add('bg-info', 'text-white');
            }
            
            toast.show();
        }

        // ========== FUNCIONES PARA PRODUCTOS ==========
        function cargarProductos(busqueda = '') {
            const transaction = db.transaction(['producto'], 'readonly');
            const store = transaction.objectStore('producto');
            const request = store.getAll();
            
            request.onsuccess = function() {
                let productos = request.result;
                
                // Filtrar si hay búsqueda
                if (busqueda) {
                    productos = productos.filter(p => 
                        p.nombre.toLowerCase().includes(busqueda.toLowerCase())
                    );
                }
                
                const tbody = document.getElementById('productos-table');
                tbody.innerHTML = '';
                
                productos.forEach(producto => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${producto.id}</td>
                        <td>${producto.nombre}</td>
                        <td>${producto.stock}</td>
                        <td>$${producto.precio_unitario.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editarProducto(${producto.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="eliminarProducto(${producto.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            };
        }

        function buscarProductos() {
            const busqueda = document.getElementById('search-producto').value;
            cargarProductos(busqueda);
        }

        function showProductoForm(producto = null) {
            editingId = producto ? producto.id : null;
            
            document.getElementById('modalTitle').textContent = producto ? 'Editar Producto' : 'Nuevo Producto';
            
            document.getElementById('modalBody').innerHTML = `
                <form onsubmit="guardarProducto(event)">
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="nombre" value="${producto ? producto.nombre : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="stock" class="form-label">Stock</label>
                        <input type="number" class="form-control" id="stock" value="${producto ? producto.stock : 0}" required>
                    </div>
                    <div class="mb-3">
                        <label for="precio" class="form-label">Precio Unitario</label>
                        <input type="number" step="0.01" class="form-control" id="precio" value="${producto ? producto.precio_unitario : 0.0}" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            `;
            
            modal.show();
        }

        function guardarProducto(event) {
            event.preventDefault();
            
            const nombre = document.getElementById('nombre').value;
            const stock = parseInt(document.getElementById('stock').value);
            const precio = parseFloat(document.getElementById('precio').value);
            
            if (!nombre) {
                showToast('Error', 'El nombre es obligatorio', 'danger');
                return;
            }
            
            const producto = { nombre, stock, precio_unitario: precio };
            
            const transaction = db.transaction(['producto'], 'readwrite');
            const store = transaction.objectStore('producto');
            
            let request;
            if (editingId) {
                producto.id = editingId;
                request = store.put(producto);
            } else {
                request = store.add(producto);
            }
            
            request.onsuccess = function() {
                modal.hide();
                showToast('Éxito', `Producto ${editingId ? 'actualizado' : 'agregado'} correctamente`, 'success');
                cargarProductos();
                updateCounts();
                editingId = null;
            };
            
            request.onerror = function() {
                showToast('Error', 'No se pudo guardar el producto', 'danger');
            };
        }

        function editarProducto(id) {
            const transaction = db.transaction(['producto'], 'readonly');
            const store = transaction.objectStore('producto');
            const request = store.get(id);
            
            request.onsuccess = function() {
                showProductoForm(request.result);
            };
        }

        function eliminarProducto(id) {
            if (confirm('¿Está seguro de que desea eliminar este producto?')) {
                const transaction = db.transaction(['producto'], 'readwrite');
                const store = transaction.objectStore('producto');
                const request = store.delete(id);
                
                request.onsuccess = function() {
                    showToast('Éxito', 'Producto eliminado correctamente', 'success');
                    cargarProductos();
                    updateCounts();
                };
            }
        }

        // ========== FUNCIONES PARA CLIENTES ==========
        function cargarClientes(busqueda = '') {
            const transaction = db.transaction(['cliente'], 'readonly');
            const store = transaction.objectStore('cliente');
            const request = store.getAll();
            
            request.onsuccess = function() {
                let clientes = request.result;
                
                if (busqueda) {
                    clientes = clientes.filter(c => 
                        c.nombre.toLowerCase().includes(busqueda.toLowerCase())
                    );
                }
                
                const tbody = document.getElementById('clientes-table');
                tbody.innerHTML = '';
                
                clientes.forEach(cliente => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${cliente.id}</td>
                        <td>${cliente.nombre}</td>
                        <td>${cliente.telefono || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editarCliente(${cliente.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="eliminarCliente(${cliente.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            };
        }

        function buscarClientes() {
            const busqueda = document.getElementById('search-cliente').value;
            cargarClientes(busqueda);
        }

        function showClienteForm(cliente = null) {
            editingId = cliente ? cliente.id : null;
            
            document.getElementById('modalTitle').textContent = cliente ? 'Editar Cliente' : 'Nuevo Cliente';
            
            document.getElementById('modalBody').innerHTML = `
                <form onsubmit="guardarCliente(event)">
                    <div class="mb-3">
                        <label for="cliente-nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="cliente-nombre" value="${cliente ? cliente.nombre : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="cliente-telefono" class="form-label">Teléfono</label>
                        <input type="text" class="form-control" id="cliente-telefono" value="${cliente ? cliente.telefono || '' : ''}">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            `;
            
            modal.show();
        }

        function guardarCliente(event) {
            event.preventDefault();
            
            const nombre = document.getElementById('cliente-nombre').value;
            const telefono = document.getElementById('cliente-telefono').value;
            
            if (!nombre) {
                showToast('Error', 'El nombre es obligatorio', 'danger');
                return;
            }
            
            const cliente = { nombre, telefono };
            
            const transaction = db.transaction(['cliente'], 'readwrite');
            const store = transaction.objectStore('cliente');
            
            let request;
            if (editingId) {
                cliente.id = editingId;
                request = store.put(cliente);
            } else {
                request = store.add(cliente);
            }
            
            request.onsuccess = function() {
                modal.hide();
                showToast('Éxito', `Cliente ${editingId ? 'actualizado' : 'agregado'} correctamente`, 'success');
                cargarClientes();
                updateCounts();
                editingId = null;
            };
        }

        function editarCliente(id) {
            const transaction = db.transaction(['cliente'], 'readonly');
            const store = transaction.objectStore('cliente');
            const request = store.get(id);
            
            request.onsuccess = function() {
                showClienteForm(request.result);
            };
        }

        function eliminarCliente(id) {
            if (confirm('¿Está seguro de que desea eliminar este cliente?')) {
                const transaction = db.transaction(['cliente'], 'readwrite');
                const store = transaction.objectStore('cliente');
                const request = store.delete(id);
                
                request.onsuccess = function() {
                    showToast('Éxito', 'Cliente eliminado correctamente', 'success');
                    cargarClientes();
                    updateCounts();
                };
            }
        }

        // ========== FUNCIONES PARA PROVEEDORES ==========
        function cargarProveedores(busqueda = '') {
            const transaction = db.transaction(['proveedor'], 'readonly');
            const store = transaction.objectStore('proveedor');
            const request = store.getAll();
            
            request.onsuccess = function() {
                let proveedores = request.result;
                
                if (busqueda) {
                    proveedores = proveedores.filter(p => 
                        p.nombre.toLowerCase().includes(busqueda.toLowerCase())
                    );
                }
                
                const tbody = document.getElementById('proveedores-table');
                tbody.innerHTML = '';
                
                proveedores.forEach(proveedor => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${proveedor.id}</td>
                        <td>${proveedor.nombre}</td>
                        <td>${proveedor.contacto || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editarProveedor(${proveedor.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="eliminarProveedor(${proveedor.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            };
        }

        function buscarProveedores() {
            const busqueda = document.getElementById('search-proveedor').value;
            cargarProveedores(busqueda);
        }

        function showProveedorForm(proveedor = null) {
            editingId = proveedor ? proveedor.id : null;
            
            document.getElementById('modalTitle').textContent = proveedor ? 'Editar Proveedor' : 'Nuevo Proveedor';
            
            document.getElementById('modalBody').innerHTML = `
                <form onsubmit="guardarProveedor(event)">
                    <div class="mb-3">
                        <label for="proveedor-nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="proveedor-nombre" value="${proveedor ? proveedor.nombre : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="proveedor-contacto" class="form-label">Contacto</label>
                        <input type="text" class="form-control" id="proveedor-contacto" value="${proveedor ? proveedor.contacto || '' : ''}">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            `;
            
            modal.show();
        }

        function guardarProveedor(event) {
            event.preventDefault();
            
            const nombre = document.getElementById('proveedor-nombre').value;
            const contacto = document.getElementById('proveedor-contacto').value;
            
            if (!nombre) {
                showToast('Error', 'El nombre es obligatorio', 'danger');
                return;
            }
            
            const proveedor = { nombre, contacto };
            
            const transaction = db.transaction(['proveedor'], 'readwrite');
            const store = transaction.objectStore('proveedor');
            
            let request;
            if (editingId) {
                proveedor.id = editingId;
                request = store.put(proveedor);
            } else {
                request = store.add(proveedor);
            }
            
            request.onsuccess = function() {
                modal.hide();
                showToast('Éxito', `Proveedor ${editingId ? 'actualizado' : 'agregado'} correctamente`, 'success');
                cargarProveedores();
                updateCounts();
                editingId = null;
            };
        }

        function editarProveedor(id) {
            const transaction = db.transaction(['proveedor'], 'readonly');
            const store = transaction.objectStore('proveedor');
            const request = store.get(id);
            
            request.onsuccess = function() {
                showProveedorForm(request.result);
            };
        }

        function eliminarProveedor(id) {
            if (confirm('¿Está seguro de que desea eliminar este proveedor?')) {
                const transaction = db.transaction(['proveedor'], 'readwrite');
                const store = transaction.objectStore('proveedor');
                const request = store.delete(id);
                
                request.onsuccess = function() {
                    showToast('Éxito', 'Proveedor eliminado correctamente', 'success');
                    cargarProveedores();
                    updateCounts();
                };
            }
        }

        // ========== FUNCIONES PARA EMPLEADOS ==========
        function cargarEmpleados(busqueda = '') {
            const transaction = db.transaction(['empleado'], 'readonly');
            const store = transaction.objectStore('empleado');
            const request = store.getAll();
            
            request.onsuccess = function() {
                let empleados = request.result;
                
                if (busqueda) {
                    empleados = empleados.filter(e => 
                        e.nombre.toLowerCase().includes(busqueda.toLowerCase())
                    );
                }
                
                const tbody = document.getElementById('empleados-table');
                tbody.innerHTML = '';
                
                empleados.forEach(empleado => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${empleado.id}</td>
                        <td>${empleado.nombre}</td>
                        <td>${empleado.cargo || ''}</td>
                        <td>$${empleado.salario ? empleado.salario.toFixed(2) : '0.00'}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editarEmpleado(${empleado.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="eliminarEmpleado(${empleado.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            };
        }

        function buscarEmpleados() {
            const busqueda = document.getElementById('search-empleado').value;
            cargarEmpleados(busqueda);
        }

        function showEmpleadoForm(empleado = null) {
            editingId = empleado ? empleado.id : null;
            
            document.getElementById('modalTitle').textContent = empleado ? 'Editar Empleado' : 'Nuevo Empleado';
            
            document.getElementById('modalBody').innerHTML = `
                <form onsubmit="guardarEmpleado(event)">
                    <div class="mb-3">
                        <label for="empleado-nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="empleado-nombre" value="${empleado ? empleado.nombre : ''}" required>
                    </div>
                    <div class="mb-3">
                        <label for="empleado-cargo" class="form-label">Cargo</label>
                        <input type="text" class="form-control" id="empleado-cargo" value="${empleado ? empleado.cargo || '' : ''}">
                    </div>
                    <div class="mb-3">
                        <label for="empleado-salario" class="form-label">Salario</label>
                        <input type="number" step="0.01" class="form-control" id="empleado-salario" value="${empleado ? empleado.salario || 0 : 0}">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            `;
            
            modal.show();
        }

        function guardarEmpleado(event) {
            event.preventDefault();
            
            const nombre = document.getElementById('empleado-nombre').value;
            const cargo = document.getElementById('empleado-cargo').value;
            const salario = parseFloat(document.getElementById('empleado-salario').value) || 0;
            
            if (!nombre) {
                showToast('Error', 'El nombre es obligatorio', 'danger');
                return;
            }
            
            const empleado = { nombre, cargo, salario };
            
            const transaction = db.transaction(['empleado'], 'readwrite');
            const store = transaction.objectStore('empleado');
            
            let request;
            if (editingId) {
                empleado.id = editingId;
                request = store.put(empleado);
            } else {
                request = store.add(empleado);
            }
            
            request.onsuccess = function() {
                modal.hide();
                showToast('Éxito', `Empleado ${editingId ? 'actualizado' : 'agregado'} correctamente`, 'success');
                cargarEmpleados();
                updateCounts();
                editingId = null;
            };
        }

        function editarEmpleado(id) {
            const transaction = db.transaction(['empleado'], 'readonly');
            const store = transaction.objectStore('empleado');
            const request = store.get(id);
            
            request.onsuccess = function() {
                showEmpleadoForm(request.result);
            };
        }

        function eliminarEmpleado(id) {
            if (confirm('¿Está seguro de que desea eliminar este empleado?')) {
                const transaction = db.transaction(['empleado'], 'readwrite');
                const store = transaction.objectStore('empleado');
                const request = store.delete(id);
                
                request.onsuccess = function() {
                    showToast('Éxito', 'Empleado eliminado correctamente', 'success');
                    cargarEmpleados();
                    updateCounts();
                };
            }
        }
    </script>
</body>
</html>
